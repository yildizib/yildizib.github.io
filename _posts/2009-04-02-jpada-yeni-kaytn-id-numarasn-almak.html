---
layout: post
title: JPA'da yeni kaydın ID numarasını almak...
date: '2009-04-02T21:49:00.001+03:00'
author: İbrahim YILDIZ
tags:
- JPA
- java persistence
- insert query
modified_time: '2010-09-15T18:49:35.421+03:00'
blogger_id: tag:blogger.com,1999:blog-2574404706234424211.post-8599823179759540579
blogger_orig_url: http://yildizib.blogspot.com/2009/04/jpada-yeni-kaytn-id-numarasn-almak.html
---

<span style="font-style: italic;">JPA</span> ile bir problem çözmeye çalıştığımızı düşünelim. Yeni bir müşteri veya adres defterine yeni bir adres kaydı atmak istiyor olalım. Ve kayıt işleminden hemen sonra kullanılmak üzere bize yeni kaydın <span style="font-style: italic;">ID</span> ( <span style="font-style: italic;">PK</span> ) numarası gerekli olsun.<br /><br />Bunu diğer yöntemler ile nasıl yapılacağına bir bakalım: Önce kayıt atılır. Sonra veritabanı sunucusu eğer destekliyorsa , örneğin: <span style="font-style: italic;">lastInsertID</span>() gibi bir komutla en son eklenen kaydın <span style="font-style: italic;">ID</span> numarası alınır. Tabi eğer böyle bir komut yok ise ve veritabanı sunucumuz, aletlerimiz <span style="font-style: italic;">transactionı</span> desteklemiyorsa bunun o an eklenen kaydın <span style="font-style: italic;">ID</span> numarası olduğunu ummamız iyimser bir yaklaşım olacaktır. Aynı anda arda arda bir kaç kayıt gelebilir ve elimizdeki <span style="font-style: italic;">ID</span> numarası başka kayıda ait olabilir.<br /><br />Bunun da çözümleri vardır. Kendi kilit - <span style="font-style: italic;">lock</span> - mekanizmanızı veya veritabanının kilit mekanizmanısını kullanabilirsiniz. Bunun da sakıncalarını, özellikle tablo bazında kilitlemelerin sakıncalarını göreceksiniz. Özellikle bir biri ile dış anahtarlar - <span style="font-style: italic;">FK</span> - ile bağlı tablolara kayıt atarken tablo kitleme bir sonsuz döngüye girebilir. Ve sistem birini feda ederek bu döngüden çıkar. Ama bu işinize yaramaz bir çözümdür.<br /><br />Ya da kendi kilit mekanizmanızı dolaylı yöntemler ile siz geliştirisiniz. Mesela tablolara birer alan koyarsınız o kayıt kilitli ise o alana bir değer atarsınız. O kayıt ile işlem yapmak isteyenler olursa eriştirmezsiniz böylece...<br /><br />Tablo kitleme olayı yeni kayıt atarken aldığınız ID numarasının o kayda ait olduğunu garantiler.<br />Ancak gerekmedikçe tablo kitlememeniz hayrınıza olacaktır. Tablo kitlemeleri sıralara, kuyruklara neden olacağından sistemin performansını düşürür.<br /><br />Gelelim JPA'da o kaydın ID numarasını nasıl alacağımıza. Öncelikle JPA ORM  yazılım iskeletidir. JPA transaction yönetimine sahiptir.<br /><br /><pre name="code" class="java"><br /><br />entitymanager.getTransaction().begin();<br />entitymanager.persist(entitybean);<br />entitymanager.getTransaction().commit();<br /><br />int Id = entitybean.getEntityBeanID().intValue();<br /><br /></pre><br />İşlem bu kadar basittir. Eğer kayıt başarılı ise <span style="font-style: italic;">commit</span>() fonksiyonu veritabanına kayıt işlemini onaylatır. Ve yeni kayıt edilecek olan <span style="font-style: italic;">entitybean</span> nesnesinin <span style="font-style: italic;">ID</span> alanı doğal olarak boştur! Ancak <span style="font-style: italic;">Commit</span>() başarlıysa bu alan <span style="font-style: italic;">JPA</span> tarafından doldurulur. Sizde kolayca bu değeri alırsınız. Ve bilirsiniz ki bu <span style="font-style: italic;">ID</span> kesinlikle o an kaydettiğiniz kayda aittir!<br /><br />İşte <span style="font-style: italic;">JPA</span> ile hayatınızı kolaylaştıran bir olay daha!!!<br />Mr. mascule reklamına benzedi biraz ama .... :)