---
layout: post
title: Bir problemim var "String" ile...
date: '2009-03-18T21:47:00.000+02:00'
author: İbrahim YILDIZ
tags:
- reflection
- java
modified_time: '2009-03-18T23:40:48.610+02:00'
thumbnail: http://4.bp.blogspot.com/_fGrsh0fTnjE/ScFThUanY8I/AAAAAAAAApU/9K1XZ77Wgfg/s72-c/debug+1.jpg
blogger_id: tag:blogger.com,1999:blog-2574404706234424211.post-6531340765617262805
blogger_orig_url: http://yildizib.blogspot.com/2009/03/bir-problemim-var-string-ile.html
---

Geçen gün bir hata ayıklama - <span style="font-style: italic;">debug</span> - işlemi sırasında bir <span style="font-style: italic;">String</span> tipinde nesneyi <span style="font-style: italic;">split</span> fonksiyonu ile parçalara ayırdığınızda, bu parçalardan her birinin asıl nesnenin değerinin bir kopyasını da taşıdığını gördüm.<br /><br />Aslında bunun böyle olduğunu ilk başta anlamadım. :)<br /><br />İlk aklıma gelen soru şu idi: Alla alla nasıl olurda parçaladığım nesnenin değeri her bir parçanın içinde bulunur ve parçaların değerleri ile <span style="font-style: italic;">value</span> özelliği - <span style="font-style: italic;">attribute</span> - aynı değeri taşımaz?<br /><br />Yani nesne değeri başka , nesne.value -> <span style="font-style: italic;">String.value</span> <- değeri başka mı ?  Nasıl olurda <span style="font-style: italic;">String</span> tipinde bir nesne <span style="font-style: italic;">split</span> fonksiyonuyla n adet parçaya ayrılır ve bu parçalardan her biri olan <span style="font-style: italic;">String</span> tipindeki nesnecikler asıl nesnenin - <span style="font-style: italic;">parçaladığımız nesne</span> - değerini taşır?<br /><br /><a onblur="try {parent.deselectBloggerImageGracefully();} catch(e) {}" href="http://4.bp.blogspot.com/_fGrsh0fTnjE/ScFThUanY8I/AAAAAAAAApU/9K1XZ77Wgfg/s1600-h/debug+1.jpg"><img style="cursor: pointer; width: 417px; height: 260px;" src="http://4.bp.blogspot.com/_fGrsh0fTnjE/ScFThUanY8I/AAAAAAAAApU/9K1XZ77Wgfg/s400/debug+1.jpg" alt="" id="BLOGGER_PHOTO_ID_5314620867155026882" border="0" /></a><br /><br />Yukarıda bu hata ayıklama işlemini görebilirsiniz.<br /><br />Sonra şu aklıma geldi: Bir parçadan asıl nesnenin değerine ulaşabilir miyim?<br />Evet bu fikir takıldı kafama ve uyuyamayacaktım ben de araştırmaya başladım internette...<br /><br />Bu değeri nasıl alabilirdim? Ve bu değer neden nesnenin parçalarında bulunuyordu?<br />Sonra Allah'a şükür etmek istiyorum ki; java iyi ki açık kaynak kod - <span style="font-style: italic;">open source</span> -.<br /><span style="font-style: italic;">OpenJDK</span>'dan<span style="font-style: italic;"> <a href="http://www.docjar.com/html/api/java/lang/String.java.html">java.lang.String</a></span> nesnesinin kaynak kodunu buldum.<br /><br />Evet anahtar özellik "<a style="font-style: italic;" name="111">private final char value[];</a>". Bu özellik eğer String tipinde bir nesne oluşturulunca değerinin bir kopyası value de tutuluyor olması. :) İşte sorumun cevabına yaklaşma anı! Ancak bu <span style="font-style: italic;">value private</span>  :) yani ben nasıl ulaşabilirim bu özelliğin değerine?<br /><br />Evet onun cevabı da <span style="font-style: italic;">Reflection</span> ...<br /><br />Aşağıdaki kod parçasıyla bu değeri almayı başardım:<br /><br /><pre><code class="Java"><br />String msg = "*141#3#123455666656564645#";<br />StringTokenizer st = new StringTokenizer(msg, "*");<br />String ilk = st.nextToken();<br />StringTokenizer st2 = new StringTokenizer(ilk, "#");<br />String ikinci = st2.nextToken();<br />String ucuncu = st2.nextToken();<br />String aman = "tamam";<br /><br />Class t = String.class;<br />Field f = t.getDeclaredField("value");<br />f.setAccessible(true);<br />System.out.println(f.get(ucuncu));<br />System.out.println(f.get(ikinci));<br />System.out.println(f.get(ilk));<br />System.out.println(f.get(msg));<br />System.out.println(f.get(aman));<br /></code></pre><br /><br />Peki bunu başardım ama bu String nesnesini parçaladım bir örüntüye göre - pattern - ancak hepsinde asıl nesnenin değerinin olması biraz pahalı bir işlem değil miydi?<br /><br />Yani value private final idi...<br />Her parça aynı nesnenin value özelliğine bir adres  ile işaret etmiyorsa - pointer - bu kadar hafızayı boş yere heba etmenin ne anlamı vardı? GC'ye o kadar güveniyorlardı yani?<br /><br />Yukarıda verdiğim java kodunu çalıştırırsanız enterasan bir sonuç çıkıyor:<br /><br /><pre><br />System.out çıktıları:<br /><br />[C@addbf1<br />[C@addbf1<br />[C@addbf1<br />[C@addbf1<br />[C@42e816<br /></pre><br />burada farklı<span style="font-style: italic;"> </span>  olan <span style="font-style: italic;"><span style="font-weight: bold;">[C42e816</span> yani </span>yeni bir String tipinde nesnedir. Diğerleri ise <span style="font-style: italic;">split</span> ile parçlanmış nesnenin parçacık nesneleri  ... <span style="color: rgb(153, 0, 0);"><br /><br />Ve aynı özelliği - </span><span style="font-style: italic; color: rgb(153, 0, 0);">value</span><span style="color: rgb(153, 0, 0);"> - paylaşıyorlar!</span><br /><br /><span style="color: rgb(153, 0, 0);">Hem <span style="font-style: italic;">private final</span> bir özellik ve hem de parçalara ayrılmış nesnenin tüm parçacık nesnelerinde aynı tip dolayısıyla aynı değer</span><span style="color: rgb(153, 0, 0);"> !</span><br /><br />Neyse sonunda bazı şeyleri çözmüş ve rahatlamış olarak uyudum.<br />Anlamış olmasamda...