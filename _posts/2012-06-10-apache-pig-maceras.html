---
layout: post
title: Apache pig macerası...
date: '2012-06-10T00:33:00.000+03:00'
author: İbrahim YILDIZ
tags:
- log parse engine
- apache pig
modified_time: '2012-06-10T00:33:00.799+03:00'
blogger_id: tag:blogger.com,1999:blog-2574404706234424211.post-6168441785652202251
blogger_orig_url: http://yildizib.blogspot.com/2012/06/apache-pig-maceras.html
---

<br />Evet bir log parçalama macerası... Özellikle apache HTTP web sunucusu veya commonlog biçemindeki loglarını parçalama işlemleri, onları işleme birer yük, hele log dosyalarının boyları GB ler mertebesinde sayıları ise yüzleri geçiyorsa...<br /><br />Bunun için ellerimle bu logları parçalayıp işleyecek ve sonrasında veritabanına yazacak kodlar yazdım. Sonra bu sistemin kararlı çalışması için gözlemleme, hata ayıklama işleriyle uğraştım... Hem eğlenceli hem de sıkıntıların bitmemesi can sıkıcı...<br /><br />Şu an kendi yazdığım sistemi çalıştığım şirkette kullanıyoruz. Kararlı olarak çalışıyor, fakat komple bir sistem olduğundan arada hatalar çıkınca eksiklikleri durmadan takip edip düzeltiyorum. Hala ...<br /><br />Sonra dedim ki Apache PIG'i bir deneyeyim. Denedim ama local olarak.&nbsp; cluster modunda denemedim. Basitçe bir pig dosyası var ettim. Sonrasında üretilmiş log dosyamı parçalattırdım. Gün bazında hit ve toplam tüketimi hesaplattırdım. Sonrasında ise kendi yazdığım kodla aynı log dosyasında gün bazında aynı raporları ladım.<br /><br />Ve şaşırdım :) ikisi de aynı sonuçları vermişti... Ben yüzlerce satır ( belki binlerce ) kod yazmıştım benze bir işi yapmak için. PIG ile aynı raporu veren betik:<br /><br /><br /><br /><br /><blockquote class="tr_bq">REGISTER '$PATH/pig-0.10.0/contrib/piggybank/java/piggybank.jar';<br /><br />DEFINE LogLoader org.apache.pig.piggybank.storage.apachelog.CombinedLogLoader();<br />DEFINE DayExtractor org.apache.pig.piggybank.evaluation.util.apachelogparser.DateExtractor('yyyy-MM-dd');<br />DEFINE CSVExcelStorage org.apache.pig.piggybank.storage.CSVExcelStorage();<br /><br />logs = LOAD 'test.access.log' USING LogLoader as (remoteAddr, remoteLogname, user, time, method,<br />uri, proto, status, bytes, referer, userAgent);<br /><br />logs = FILTER logs BY status&nbsp; == '200' OR status&nbsp; == '206' OR status == '304' parallel 10;<br /><br />-- project just the columns we will need<br />logs = FOREACH logs GENERATE remoteAddr, DayExtractor(time) as day, bytes parallel 10;<br /><br />logs = GROUP logs BY day parallel 10;<br /><br />logs = FOREACH logs GENERATE&nbsp; group, COUNT(logs.remoteAddr) as hit, SUM(logs.bytes) as total_bytes parallel 10;<br />--logs = GROUP logs BY DayExtractor(time) as day;<br /><br />--STORE logs INTO 'result.csv' ;<br /><br />DUMP logs;</blockquote><br /><br /><br /><br />evet yukarıdaki kod benim logu parçalama ve işlemem sonucunda çıkan toplamı verdi. Biraz daha uzun süre çalışıyordu ama PIG bu kadar esnek ve kolay yapısıyla beni cezbetti.<br /><br />Daha cluster olarak nasıl kullanacağım, anlık olarak logları nasıl pig ile işleyeceğimi bilgmiyorum. Şu an PIG ile log dosyalarıni bir gün geriden istediğim gibi, local modda , parçalayabileceğimi yani istediğim raporu çıkarabileceğimi biliyorum...<br /><br />Denemelere devam...